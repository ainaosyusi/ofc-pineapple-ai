# OFC Pineapple AI - 現在の開発状況

## 📅 最終更新: 2026-01-16

---

## 🚀 現在のステータス: Phase 5 学習中

| 項目 | 値 |
|:---|:---|
| **フェーズ** | Phase 5: 3-Max Self-Play |
| **環境** | 3人対戦、54カード（ジョーカー2枚） |
| **EC2 IP** | `52.68.185.12` |
| **PID** | 1995 |
| **目標ステップ** | 20,000,000 |
| **推定完了時間** | 約14.7時間 |

---

## 📊 フェーズ別進捗

```
Phase 1 ──► Phase 2 ──► Phase 3 ──► Phase 4 ──► Phase 5
ファウル     役作り      Self-Play    ジョーカー    3人対戦
回避学習    基礎       (2人)       対応       Self-Play
37.8%      32.0%      58-63%     25.1% 🏆   (学習中)
```

### 達成したマイルストーン

| フェーズ | 目標 | 結果 | 評価 |
|:---|:---|:---|:---:|
| Phase 1 | ファウル回避の基礎習得 | 37.8% | ✅ |
| Phase 2 | 役作りと報酬最大化 | 32.0%, Royalty 0.26 | ✅ |
| Phase 3 | 対戦型戦略の習得 | 58-63%（攻撃的） | ⚠️ |
| **Phase 4** | ジョーカー活用 | **25.1%**, Royalty **0.85** | 🏆 |
| Phase 5 | 3人戦の戦略習得 | (学習中) | 🚀 |

---

## 🎯 Phase 5 の特徴

### 観測空間（7チャンネル、約720次元）

```python
{
    'my_board': 162,           # 自分のボード
    'my_hand': 270,            # 手札
    'next_opponent_board': 162, # 下家のボード
    'prev_opponent_board': 162, # 上家のボード
    'my_discards': 54,         # 自分の捨て札
    'unseen_probability': 54,  # 確率マップ
    'position_info': 3,        # ポジション（BTN/SB/BB）
}
```

### AIが学習する能力

1. **アウツ・ブロック戦略**
   - 「上家がハートを集めているから、自分はフラッシュに行かない」
   - 「枯れているスートを避ける」

2. **ポジション戦略**
   - 「最後の手番だから、相手の配置を見てから安全策を取る」
   - 後出し有利を活かした判断

3. **リスク管理**
   - 「2人相手にファウルすると×2のダメージ → より慎重に」

---

## 📁 関連ファイル

| ファイル | 説明 |
|:---|:---|
| `src/python/ofc_3max_env.py` | 3人対戦環境（PettingZoo互換） |
| `src/python/train_phase5_3max.py` | Phase 5 学習スクリプト |
| `src/python/ofc_phase1_env.py` | Phase 1/4 環境 |
| `src/cpp/game.hpp` | C++ゲームエンジン（3人対応） |

---

## 📈 学習曲線の傾向

### Phase 4 (ジョーカー対応) - ベストモデル

| ステップ | ファウル率 | Mean Royalty |
|:---|:---:|:---:|
| 0 | 69% | 0.1 |
| 5M | 35% | 0.7 |
| 10.5M | **25.1%** | **0.85** |

### 分析
- ジョーカーは「役完成の保険」として効果的に機能
- 攻撃的なPhase 3よりも安定したプレイスタイルを獲得
- Fantasyland突入率(1.1%)は改善の余地あり

---

## 🔧 次のステップ

1. [ ] Phase 5 学習完了（20M ステップ）
2. [ ] 3人対戦モデルの評価
3. [ ] Phase 6 検討（MCTS統合）
4. [ ] UI/デモ作成

---

## 📞 学習監視コマンド

```bash
# ログ確認
ssh -i ofc-training-key.pem ubuntu@52.68.185.12 "tail -50 ~/OFC-NN/training_phase5.log"

# プロセス確認
ssh -i ofc-training-key.pem ubuntu@52.68.185.12 "pgrep -af python"
```
